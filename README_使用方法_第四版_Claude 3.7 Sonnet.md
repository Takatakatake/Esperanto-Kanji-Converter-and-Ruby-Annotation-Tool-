# エスペラント文の文字列(漢字)置換ツールの使い方説明書

## アプリの概要

このアプリは、エスペラント語の文章を処理して、以下のような機能を提供します：

- エスペラント語の文章に日本語訳や漢字表記をルビとして追加
- エスペラント語の特殊文字（ĉ, ĝ, ĥ, ĵ, ŝ, ŭ）を様々な表記形式に変換
- HTMLルビ形式や括弧形式での出力
- 語根や接尾辞などの処理による高精度な置換処理

この説明書では、アプリの主要機能とその使い方を詳しく解説します。

## アプリの構成

このアプリは以下のファイルで構成されています：

1. **main.py** - メインアプリケーション。エスペラント文の置換処理を行うインターフェース
2. **エスペラント文(漢字)置換用のJSONファイル生成ページ.py** - 置換ルールを定義するJSONファイルを作成するページ
3. **esp_text_replacement_module.py** - テキスト置換処理を行うモジュール
4. **esp_replacement_json_make_module.py** - JSONファイル生成を支援するモジュール

## メイン機能の使い方

### 1. メインページ（エスペラント文の置換・ルビ振り）

メインページでは、エスペラント語のテキストを入力し、さまざまな形式で出力できます。

#### 基本的な使い方

1. **JSONファイルの選択**:
   - 「デフォルトを使用する」: アプリに組み込まれたデフォルトの置換ルールを使用
   - 「アップロードする」: 自作またはJSONファイル生成ページで作成した置換ルールをアップロード

2. **高度な設定（オプション）**:
   - 「並列処理を使う」にチェックを入れると処理が高速化（大量テキストの場合に有効）
   - 「同時プロセス数」で並列処理の量を調整（2〜4の範囲で設定可能）

3. **出力形式の選択**:
   - **HTML格式_Ruby文字_大小调整**: ルビのサイズを文字列の長さに応じて自動調整するHTML形式
   - **HTML格式_Ruby文字_大小调整_汉字替换**: 上記と同様だが、親文字と子文字（ルビ）の位置を逆転
   - **HTML格式**: 標準的なHTMLルビ形式
   - **HTML格式_汉字替换**: 親文字と子文字（ルビ）の位置を逆転したHTMLルビ形式
   - **括弧(号)格式**: エスペラント語(日本語訳)の形式
   - **括弧(号)格式_汉字替换**: 日本語訳(エスペラント語)の形式
   - **替换后文字列のみ**: 単純に置換後の文字列のみを表示

4. **入力テキストのソース選択**:
   - 「手動入力」: テキストエリアに直接入力
   - 「ファイルアップロード」: テキストファイル（UTF-8形式）をアップロード

5. **エスペラント文の入力と特殊指定**:
   - テキストエリアにエスペラント語の文章を入力
   - 特殊指定：
     - `%文字列%`: この部分は置換されず、元のまま保持されます（最大50文字）
     - `@文字列@`: この部分だけを局所的に置換します（最大18文字）

6. **出力文字形式の選択**:
   - 「上付き文字」: エスペラント特殊文字をĉのように表示
   - 「x 形式」: エスペラント特殊文字をcxのように表示
   - 「^形式」: エスペラント特殊文字をc^のように表示

7. **送信ボタン**を押して処理を実行

#### 処理結果の表示と活用

処理が完了すると、下部に結果が表示されます：

- HTML形式の場合：「HTMLプレビュー」タブと「置換結果（HTMLソースコード）」タブで確認可能
- その他の形式：「置換結果テキスト」タブで確認可能
- 「置換結果のダウンロード」ボタンで結果をファイルとして保存できます

### 2. JSONファイル生成ページ

このページでは、エスペラント文の置換に使用するJSONファイルを作成できます。

#### 基本的な使い方

1. **使い方の説明**:
   - ページ上部の「使い方の説明を開く」から詳細な利用手順を確認できます

2. **サンプルファイル**:
   - 「サンプルファイル一覧」から各種サンプルファイルをダウンロード可能
   - エスペラント語根と日本語訳を対応させたCSVファイル
   - 漢字対応リスト
   - 語根分解法設定JSON
   - 置換後文字列設定JSON

3. **出力形式の選択**:
   - メインページと同様の出力形式オプションから選択

4. **CSVファイルの準備**:
   - 「アップロードする」でCSVファイルをアップロード
   - 「デフォルトを使用する」でデフォルトのCSVを使用

5. **JSONファイル（語根分解法など）の準備**:
   - エスペラント単語の語根分解法と置換後文字列のカスタム設定を指定
   - アップロードまたはデフォルトを選択

6. **高度な設定**:
   - 並列処理の設定（オプション）

7. **置換用JSONファイルの作成**:
   - 「置換用JSONファイルを作成する」ボタンを押して処理を実行
   - 処理には時間がかかる場合があります

8. **結果のダウンロード**:
   - 処理完了後、生成されたJSONファイルをダウンロードできます

## 特徴的な機能の詳細説明

### エスペラント特殊文字の処理

エスペラント語特有の文字（ĉ, ĝ, ĥ, ĵ, ŝ, ŭ）について、以下の表記法を相互変換できます：
- 字上符形式（ĉ, ĝ, ĥ, ĵ, ŝ, ŭ）
- x形式（cx, gx, hx, jx, sx, ux）
- ^形式（c^, g^, h^, j^, s^, u^）

### 特殊指定による置換制御

テキスト中の特定部分の置換方法をカスタマイズできます：

1. **%文字列%**:
   - この部分は置換されず、元のテキストがそのまま出力に含まれます
   - 例: `Mi %ne sxatas% tion.` → "Mi ne sxatas tion"のnexatasは置換されません

2. **@文字列@**:
   - この部分だけを局所的に置換します
   - 例: `Mi @sxatas@ tion.` → "sxatas"だけが局所的に置換されます

### HTML出力のルビサイズ自動調整

「HTML格式_Ruby文字_大小调整」形式では、ルビの文字数に応じて自動的にサイズを調整します：
- 文字数が多い場合は小さく表示
- 文字数が少ない場合は大きく表示
- 必要に応じて、ルビに改行を挿入して可読性を向上

### 並列処理

大量のテキストを効率的に処理するため、マルチプロセッシングによる並列処理をサポートしています：
- 「並列処理を使う」オプションで有効化
- 「同時プロセス数」で処理の並列度を調整可能

## 応用例

### 1. エスペラント初学者向け学習教材の作成

エスペラント語のテキストに日本語訳をルビとして追加することで、単語の意味をすぐに参照できる学習教材を作成できます。

```
例：
Original: La suno brilas en la ĉielo.
出力(HTML形式): <ruby>La</ruby> <ruby>suno<rt>太陽</rt></ruby> <ruby>brilas<rt>輝く</rt></ruby> <ruby>en<rt>~の中に</rt></ruby> <ruby>la</ruby> <ruby>ĉielo<rt>空</rt></ruby>.
```

### 2. エスペラント文章の漢字表記変換

エスペラント語を漢字に置き換えて表示することができます。

```
例：
Original: Mi lernas Esperanton.
出力(漢字置換): 我学習世界語。
```

### 3. 特定単語だけを強調した学習用テキスト

特定の語彙だけにルビを振ることで、学習のフォーカスを当てることができます。

```
例：
Original: Mi @lernas@ Esperanton @ĉiutage@.
出力: Mi <ruby>lernas<rt>学ぶ</rt></ruby> Esperanton <ruby>ĉiutage<rt>毎日</rt></ruby>.
```

## トラブルシューティング

### JSONファイルの読み込みエラー

**症状**: 「JSONファイルの読み込みに失敗」というエラーメッセージが表示される

**解決策**:
- ファイルがUTF-8形式で保存されていることを確認
- JSONの構文エラーがないか確認（括弧や引用符の対応など）
- サンプルJSONをダウンロードして構造を比較

### 置換結果が期待通りでない

**症状**: 特定の単語が置換されない、または意図しない置換が行われる

**解決策**:
- より長い単語が優先的に置換されることを理解する（例: "internacia"は"inter"+"naci"+"a"より優先）
- 局所的な置換のために@文字列@を使用する
- 置換したくない部分は%文字列%で保護する
- CSVファイルを編集して語根と訳の対応関係を修正する

### 処理が遅い場合

**症状**: 大きなテキストの処理に時間がかかる

**解決策**:
- 「並列処理を使う」オプションを有効にする
- 「同時プロセス数」を増やす（コンピュータの能力に応じて）
- 巨大なテキストの場合は、小さな部分に分けて処理する

## 便利な使い方のヒント

1. **置換用JSONファイルのカスタマイズ**:
   - 自分専用の語彙対応表を作成したい場合は、サンプルCSVを編集して独自のJSONファイルを生成できます

2. **効率的な学習方法**:
   - 新しい語彙だけに@文字列@を適用することで、既知の単語は置換せず、新出単語だけにルビを振ることができます

3. **HTMLファイルの活用**:
   - 生成したHTMLファイルはウェブブラウザで開いて閲覧可能です
   - CSSを追加編集することで、さらに見やすくカスタマイズできます

4. **定型文の保存**:
   - よく使うエスペラント文のパターンはテキストファイルとして保存しておき、ファイルアップロード機能を使うと便利です

## まとめ

このアプリは、エスペラント語の学習や文書作成を支援するための強力なツールです。エスペラント文の日本語訳や漢字表記への変換、ルビ振りなど、様々な機能を活用して、エスペラント語の理解や学習効率を高めることができます。特殊文字の表記法変換や部分的な置換制御など、細かなカスタマイズも可能です。

ぜひ様々な機能を試してみて、エスペラント語学習や文書作成に役立ててください。
