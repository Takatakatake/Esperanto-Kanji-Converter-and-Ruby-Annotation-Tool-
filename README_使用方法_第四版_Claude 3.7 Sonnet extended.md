# エスペラント文 漢字置換・ルビ注釈ツール 利用ガイド

## はじめに

「エスペラント文 漢字置換・ルビ注釈ツール」は、エスペラント語のテキストを処理し、以下のような変換を行うウェブアプリケーションです：

- エスペラント語の単語を漢字に置き換え
- エスペラント語の単語に日本語訳をルビとして付与
- 特殊文字（ĉ, ĝ, ĥ, ĵ, ŝ, ŭなど）の表示形式を変更

このガイドでは、アプリの基本的な使い方から応用的な使い方まで、段階的に説明します。

## 目次

1. [アプリの基本構成](#アプリの基本構成)
2. [メインページの使い方](#メインページの使い方)
3. [JSONファイル生成ページの使い方](#jsonファイル生成ページの使い方)
4. [特殊記法（%と@）の使い方](#特殊記法の使い方)
5. [出力形式の詳細](#出力形式の詳細)
6. [よくある質問とトラブルシューティング](#よくある質問とトラブルシューティング)

## アプリの基本構成

このアプリは主に2つのページから構成されています：

1. **メインページ**：エスペラント文を入力し、変換結果を得るページ
2. **JSONファイル生成ページ**：置換ルールを定義するJSONファイルを作成するページ

通常の利用手順としては：

1. まず「JSONファイル生成ページ」で置換ルールを設定し、JSONファイルを生成
2. メインページでそのJSONファイルを使用して、エスペラント文の変換を行う

しかし、初めての使用時にはデフォルトのJSONファイルを使用することもできますので、まずはメインページから始めることをお勧めします。

## メインページの使い方

### 基本的な使い方

1. **JSONファイルの準備**：
   - 「デフォルトを使用する」を選択すると、あらかじめ用意されたルールでエスペラント文の変換ができます
   - 「アップロードする」を選択すると、自分で作成したJSONファイルを使用できます
   - サンプルJSONは「サンプルJSON(置換用JSONファイル)」の折りたたみメニューからダウンロード可能です

2. **高度な設定（並列処理）**：
   - 「並列処理を使う」にチェックを入れると、処理速度が向上します（特に長文の場合に効果的）
   - 「同時プロセス数」は環境に応じて2〜4の間で設定してください

3. **出力形式の選択**：
   - HTMLルビ形式、括弧形式、単純置換など、変換結果の表示形式を選択します
   - JSONファイルを作成したときと同じ形式を選択することをお勧めします

4. **入力テキストの準備**：
   - 「手動入力」：テキストエリアに直接エスペラント文を入力
   - 「ファイルアップロード」：UTF-8形式のテキストファイルをアップロード

5. **変換オプションの設定**：
   - 「出力文字形式」でエスペラント特殊文字の表示方法を選択
     - 「上付き文字」：ĉ, ĝなどの字上符形式（推奨）
     - 「x形式」：cx, gxなど
     - 「^形式」：c^, g^など

6. **処理の実行**：
   - 「送信」ボタンをクリックして変換処理を実行
   - 「キャンセル」ボタンで処理を中止

7. **結果の確認とダウンロード**：
   - HTML形式の場合はプレビューとソースコードの両方が表示されます
   - 「置換結果のダウンロード」ボタンで結果をファイルとして保存できます

### 詳細設定

#### JSONファイルについて

JSONファイルには次の3種類の置換ルールが含まれています：

1. 全域置換用リスト：通常のエスペラント単語の置換ルール
2. 局部文字置換用リスト：@...@で囲まれた部分に適用されるルール
3. 二文字語根置換用リスト：短い語根や接頭辞・接尾辞の置換ルール

#### 高度な設定（並列処理）

並列処理を使うと、テキストを複数のセグメントに分割して同時に処理します。長文を処理する場合に特に有効ですが、短い文では効果が少ないか、むしろオーバーヘッドが発生する場合があります。

#### 出力形式の詳細

- **HTML格式_Ruby文字_大小调整**：日本語訳をルビとして表示し、ルビのサイズを調整
- **HTML格式_Ruby文字_大小调整_汉字替换**：漢字を本文として表示し、元のエスペラント語をルビとして表示
- **HTML格式**：シンプルなHTMLルビ表示（サイズ調整なし）
- **HTML格式_汉字替换**：シンプルなHTMLルビ表示（漢字が本文）
- **括弧(号)格式**：「エスペラント語(日本語訳)」形式
- **括弧(号)格式_汉字替换**：「漢字(エスペラント語)」形式
- **替换后文字列のみ(仅)保留(简单替换)**：置換後の文字列のみを表示

## JSONファイル生成ページの使い方

独自の置換ルールを作成したい場合は、このページを使用してJSONファイルを生成します。

### 基本的な手順

1. **サンプルファイルの確認**：
   - 「サンプルファイル一覧」の折りたたみメニューでさまざまなサンプルファイルをダウンロードし、フォーマットを確認します

2. **出力形式の選択**：
   - メインページと同様に、出力形式を選択します
   - 選択した形式に応じたプレビューが表示されます

3. **CSVファイルの準備**：
   - 「アップロードする」：自分で作成したCSVファイルをアップロード
   - 「デフォルトを使用する」：サンプルCSVを使用
   - CSVファイルには「エスペラント語根」と「日本語訳または漢字」の対応が記載されています

4. **JSONファイル（語根分解法）の準備**：
   - エスペラント単語の語根分解方法を定義するJSONファイルを選択
   - このファイルには、語尾の処理方法や特殊な置換ルールが定義されています

5. **置換後文字列の設定**：
   - さらに細かい置換ルールを定義するJSONファイルを選択（通常はデフォルトで十分）

6. **並列処理の設定**：
   - メインページと同様に、並列処理の使用有無とプロセス数を設定

7. **JSONファイルの生成**：
   - 「置換用JSONファイルを作成する」ボタンをクリックして生成処理を実行
   - 生成されたJSONファイルはダウンロードボタンからダウンロード可能

### CSVファイルの作成方法

CSVファイルには、エスペラント語根と対応する日本語訳や漢字を記述します。フォーマットは以下の通りです：

```
エスペラント語根,日本語訳または漢字
amik,友
ĉiel,空
```

正確な置換を行うためには、語根の正確な識別が重要です。エスペラント語の活用語尾（-o, -a, -e, -i, -as など）は自動的に処理されます。

### 語根分解設定JSONの構造

語根分解JSONファイルでは、エスペラント単語がどのように語根分解されるかを定義します。各項目は以下の形式です：

```
["語根", "優先度", ["処理オプション"]]
```

例：
```
["am", "dflt", ["verbo_s1"]]
```

- "am"：エスペラント語根
- "dflt"：デフォルトの優先度（文字数×10000）
- ["verbo_s1"]：この語根に動詞活用語尾を追加する

## 特殊記法の使い方

### %記法：置換をスキップする

文章中で特定の部分を置換処理から除外したい場合、`%...%`で囲みます。

**例：**
```
La %esperantisto% parolas bone.
```

この例では、「esperantisto」という単語は置換されずにそのまま表示されます。

### @記法：局所的に置換する

文章中で特定の部分だけを局所的に置換したい場合、`@...@`で囲みます。

**例：**
```
Li estas @homo@ kaj vivas en urbo.
```

この例では、「homo」という単語だけが局所的に置換されます。

### 注意点

- %で囲めるのは50文字以内です
- @で囲めるのは18文字以内です
- これらの記号は必ず対になるように使用してください

## 出力形式の詳細

### HTML形式のルビ表示

HTML形式を選択すると、ルビ付きのHTMLが生成されます。このHTMLはブラウザで直接表示できます。

**特徴：**
- ルビのサイズ自動調整（_大小调整がある場合）
- ルビの色は青色で表示
- 長すぎるルビは自動的に改行

### 括弧形式

括弧形式では、エスペラント語とその訳または漢字が括弧で区切られて表示されます。

**例：**
```
amiko(友)
```

または漢字置換の場合：
```
友(amiko)
```

### 単純置換

単純置換では、エスペラント語が完全に訳語や漢字に置き換えられます。

## よくある質問とトラブルシューティング

### Q: 処理が遅いです。どうすれば速くなりますか？

A: 「並列処理を使う」にチェックを入れて、お使いの環境に応じて「同時プロセス数」を2〜4に設定してみてください。ただし、短い文章では効果が少ない場合があります。

### Q: 特定の単語が思った通りに置換されません。どうすれば良いですか？

A: 以下の方法を試してみてください：
1. JSONファイル生成ページでCSVファイルを修正し、該当する語根と訳語の対応を追加または修正する
2. @記法を使って局所的に置換する
3. 語根分解設定JSONで優先度を調整する

### Q: HTML出力をWordなどの文書に取り込みたいです。どうすれば良いですか？

A: ブラウザでHTMLを表示し、表示された内容をコピーして文書に貼り付けるか、HTMLを保存してWordでHTMLファイルを開いてください。ただし、フォーマットが完全に保持されない場合があります。

### Q: エスペラント特殊文字（ĉ, ĝなど）が正しく表示されません。

A: 入力テキストが正しいUTF-8エンコーディングであることを確認してください。また、「出力文字形式」で「x形式」または「^形式」を選択すると、特殊文字を使わずに表示できます。

### Q: エラーが発生して処理が中断します。

A: 以下を確認してください：
1. 入力テキストに不正な文字が含まれていないか
2. %や@記法を使用している場合、対応する閉じ記号があるか
3. アップロードするJSONファイルが正しい形式か

## 応用例

### 学習用テキストの作成

エスペラント初学者向けの学習テキストを作成するために、すべての単語に日本語訳のルビを振ることができます。

**手順：**
1. メインページで「HTML格式_Ruby文字_大小调整」を選択
2. エスペラント文を入力して処理
3. 生成されたHTMLをブラウザで開き、学習用の教材として使用

### 漢字エスペラント

エスペラント語を漢字に置き換えた「漢字エスペラント」を作成できます。

**手順：**
1. JSONファイル生成ページで漢字対応リストのCSVをアップロード
2. 「HTML格式_汉字替换」または「括弧(号)格式_汉字替换」を選択
3. 生成されたJSONファイルをメインページで使用
4. エスペラント文を入力して処理

### 辞書の作成

よく使うエスペラント単語とその訳語の対応表を作成できます。

**手順：**
1. CSVファイルに対応を追加
2. JSONファイル生成ページで処理
3. メインページで「括弧(号)格式」を選択して変換

## まとめ

「エスペラント文 漢字置換・ルビ注釈ツール」は、エスペラント語の学習や読解をサポートする強力なツールです。基本的な機能からカスタム設定まで、幅広いニーズに対応します。

このガイドが、アプリの効果的な活用に役立つことを願っています。さらに詳しい情報や最新版は、GitHubリポジトリをご覧ください。