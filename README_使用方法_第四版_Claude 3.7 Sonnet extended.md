# エスペラント文字変換・ルビ振りツール 利用ガイド

このガイドでは、「エスペラント文字変換・ルビ振りツール」の使い方を詳しく説明します。このアプリは、エスペラント文に漢字置換を行ったり、日本語訳をHTMLルビとして表示したりするためのツールです。

## 目次

1. [アプリの概要](#アプリの概要)
2. [メイン機能「エスペラント文の漢字置換・ルビ振り」の使い方](#メイン機能エスペラント文の漢字置換ルビ振りの使い方)
3. [「JSONファイル生成ページ」の使い方](#jsonファイル生成ページの使い方)
4. [応用例と使用シナリオ](#応用例と使用シナリオ)
5. [よくある質問と注意点](#よくある質問と注意点)

## アプリの概要

このアプリは主に2つの機能で構成されています：

1. **メイン機能**：エスペラント文を日本語訳や漢字に置き換え、ルビを振る機能
2. **JSONファイル生成**：置換ルールを定義したJSONファイルを作成する機能

これらの機能を組み合わせることで、エスペラント文を様々な形式（HTML形式のルビ付きテキスト、括弧形式など）で表示できます。

## メイン機能「エスペラント文の漢字置換・ルビ振り」の使い方

### 基本的な使い方

1. **JSONファイルの選択**
   - 「デフォルトを使用する」または「アップロードする」を選択します
   - 「アップロードする」を選んだ場合は、自分で作成した置換用JSONファイルをアップロードします
   - サンプルJSONは折りたたみメニューからダウンロードできます

2. **高度な設定**
   - 「並列処理についての設定を開く」から並列処理の使用有無と同時プロセス数を設定できます
   - 大きなテキストを処理する場合、並列処理を有効にすると処理が高速化します

3. **出力形式の選択**
   - 以下の形式から選択できます：
     - **HTML格式_Ruby文字_大小调整**：ルビのサイズを調整するHTML形式
     - **HTML格式_Ruby文字_大小调整_汉字替换**：上記と同様だが漢字置換も行う
     - **HTML格式**：通常のHTMLルビ形式
     - **HTML格式_汉字替换**：通常のHTMLルビ形式で漢字置換も行う
     - **括弧(号)格式**：括弧形式（例：エスペラント語(日本語訳)）
     - **括弧(号)格式_汉字替换**：括弧形式で漢字置換も行う
     - **替换后文字列のみ(仅)保留(简单替换)**：単純置換（訳語のみ表示）

4. **入力テキストの選択**
   - 「手動入力」か「ファイルアップロード」を選択します
   - ファイルアップロードの場合はUTF-8形式のテキストファイルをアップロードします

5. **テキスト入力と処理設定**
   - テキストエリアにエスペラント文を入力します
   - 「出力文字形式」を選択します：
     - **上付き文字**：ĉ, ĝなどの字上符形式
     - **x 形式**：cx, gxなどのx表記形式
     - **^形式**：c^, g^などのハット記号形式
   - 「送信」ボタンを押して処理を実行します

6. **結果の表示とダウンロード**
   - HTML形式の場合は「HTMLプレビュー」と「HTML ソースコード」の2つのタブで結果を確認できます
   - その他の形式では「置換結果テキスト」タブで結果を確認できます
   - 「置換結果のダウンロード」ボタンで処理結果をファイルとして保存できます

### 特殊な機能

#### %による置換スキップ

`%`で囲んだ部分（50文字以内）は置換されず、元のまま保持されます。

例：
```
La %Universala Esperanto-Asocio% estas internacia organizaĵo.
```
この場合、「Universala Esperanto-Asocio」は置換されず、その他の部分だけが置換されます。

#### @による局所的な置換

`@`で囲んだ部分（18文字以内）は局所的に置換されます。標準の置換ルールではなく、特定の置換ルールが適用されます。

例：
```
Mi @amas@ vin.
```
この場合、「amas」部分のみ置換ルールが適用されます。

## JSONファイル生成ページの使い方

メインアプリでの置換に使用するJSONファイルを自分で作成したい場合に利用します。

### 基本的な使い方

1. **ページへのアクセス**
   - サイドバーから「エスペラント文(漢字)置換用のJSONファイル生成ページ」を選択します

2. **サンプルファイルの確認**
   - 「サンプルファイル一覧(ダウンロード用)」から、必要なサンプルファイルをダウンロードして内容を確認できます
     - **サンプルCSV１**：エスペラント語根-日本語訳ルビ対応リスト
     - **サンプルCSV２・３**：エスペラント語根-漢字対応リスト
     - **サンプルJSON１**：エスペラント単語語根分解法ユーザー設定
     - **サンプルJSON２**：置換後文字列のユーザー設定
     - **サンプルExcel１**：習得レベル付きのエスペラント語根-日本語訳ルビ対応リスト

3. **出力形式の選択**
   - メインページと同様の出力形式を選択します
   - 選んだ形式によって、生成されるJSONファイルの内容が変わります

4. **CSVファイルの準備（ステップ１）**
   - 「アップロードする」または「デフォルトを使用する」を選択します
   - アップロードする場合は、エスペラント語根と日本語訳/漢字を対応させたCSVファイルを用意します
   - CSVファイルは1列目にエスペラント語根、2列目に日本語訳/漢字を記載したものを使用します

5. **JSONファイルの準備（ステップ２）**
   - 語根分解法を追加指定するJSONファイルを選択（アップロードまたはデフォルト）
   - 置換後文字列を追加指定するJSONファイルを選択（アップロードまたはデフォルト）

6. **並列処理の設定（ステップ３）**
   - 必要に応じて並列処理の使用と同時プロセス数を設定します

7. **置換用JSONファイルの作成**
   - 「置換用JSONファイルを作成する」ボタンをクリックして処理を実行します
   - 処理が完了したら「Download 最终的な替换用リスト(列表)(合并3个JSON文件)」ボタンでJSONファイルをダウンロードします

### CSVファイルのカスタマイズ

エスペラント語根と日本語訳/漢字の対応関係をカスタマイズする場合は、以下の形式のCSVファイルを作成します：

```
エスペラント語根,日本語訳または漢字
esper,希望
lingv,言語
...
```

コメント行を挿入する場合は行頭に`#`を付けます。

### JSONファイルの設定項目

#### 語根分解法設定JSONファイル

エスペラント単語の語根分解方法と、置換リストに追加する派生形を指定します。基本形式は：

```json
[
  ["語根", "優先順位", ["接尾辞指定リスト"]]
]
```

例：
```json
[
  ["am", "dflt", ["verbo_s1"]],
  ["kur", "40000", ["verbo_s1", "verbo_s2", "a", "e"]]
]
```

- **語根**：エスペラント語の語根
- **優先順位**：
  - "dflt"：デフォルト（語根の文字数×10000）
  - 数字：明示的な優先順位
  - "-1"：置換対象から除外
- **接尾辞指定リスト**：
  - "verbo_s1"：動詞活用語尾(as, is, os, us, at, itなど)を追加
  - "verbo_s2"：動詞の命令法・不定法(u, i)を追加
  - "a", "e", "o"など：形容詞・副詞・名詞の語尾を追加
  - "ne"：語根自体も置換対象にする

#### 置換後文字列設定JSONファイル

特定の単語に対して、独自の漢字や文字列を割り当てる際に使用します。基本形式は：

```json
[
  ["語根分解", "優先順位", ["接尾辞指定リスト"], "置換後文字列"]
]
```

この設定は、CSVファイルの編集だけでは対応できない特殊なケースに使用します。

## 応用例と使用シナリオ

### シナリオ1：エスペラント初学者向け教材作成

1. デフォルトのJSONファイルを使用
2. エスペラント文をテキストエリアに入力
3. 出力形式を「HTML格式_Ruby文字_大小调整」に設定
4. 出力文字形式を「上付き文字」に設定
5. 処理結果をHTMLファイルとしてダウンロード

→ エスペラント文に日本語訳がルビとして表示された学習教材が作成できます。

### シナリオ2：オリジナルの漢字対応表を使ったエスペラント文の漢字化

1. CSVファイルに独自のエスペラント語根-漢字対応表を作成
2. JSONファイル生成ページでJSONファイルを作成
3. メインページで作成したJSONファイルをアップロード
4. エスペラント文を入力し、出力形式を「HTML格式_Ruby文字_大小调整_汉字替换」に設定
5. 処理を実行

→ 独自の漢字表記規則に従ったエスペラント文の漢字化が実現できます。

### シナリオ3：長文テキストの一括処理

1. エスペラント文のテキストファイルを用意
2. 入力テキストのソースを「ファイルアップロード」に設定
3. テキストファイルをアップロード
4. 必要に応じて並列処理を有効化
5. 処理を実行

→ 長文や書籍全体などの大量テキストを効率的に処理できます。

## よくある質問と注意点

### Q1：どのような出力形式を選べばよいですか？

- 学習教材として使用する場合は「HTML格式_Ruby文字_大小调整」がおすすめです
- 漢字表記を主体にしたい場合は「HTML格式_Ruby文字_大小调整_汉字替换」を選択します
- シンプルな形式が必要な場合は「括弧(号)格式」を選びます

### Q2：JSONファイルはどのように作成すればよいですか？

1. 基本的にはサンプルCSVを編集して必要な対応関係を定義します
2. JSONファイル生成ページで必要な設定を行います
3. 「置換用JSONファイルを作成する」ボタンをクリックして生成します

### Q3：テキストが正しく置換されない場合はどうすればよいですか？

- %...% で囲って置換をスキップする方法を試してみてください
- @...@ で囲って局所的に置換する方法も有効です
- 必要に応じてCSVファイルやJSONファイルを編集して、問題のある語根の置換ルールを修正してください

### 注意点

- 大きなテキストを処理する場合は、並列処理を有効にすると高速化されます
- 複雑な語形変化を持つエスペラント語では完全な置換が難しい場合があります
- HTMLルビ表示は、対応しているブラウザでのみ正しく表示されます
- JSONファイルは大きくなる場合があるため（約50MB）、PCのメモリに注意してください

以上で「エスペラント文字変換・ルビ振りツール」の基本的な使い方の説明を終わります。このツールを活用して、エスペラント学習や文書作成にお役立てください。
